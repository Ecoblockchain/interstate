/* constraintjs - v0.9.4-beta (http://cjs.from.so/) */
var cjs=function(a){"use strict";var b,c,d=Array.prototype,e=Object.prototype,f=(Function.prototype,String.prototype),g=d.slice,h=e.toString,i=d.concat,j=d.push,k=d.some,l=d.indexOf,m=d.every,n=d.forEach,o=(Object.keys,d.filter),p=d.reduce,q=d.map,r=f.trim,s=function(a,b){return function(){return a.apply(b,arguments)}},t=function(a){return r?r.call(a):String(a).replace(/^\s+|\s+$/g,"")},u=a.document,v=function(b,c){return a.setTimeout(b,c)},w=function(b,c){return a.clearTimeout(b,c)},x={"+":function(a){return+a},"-":function(a){return-a},"~":function(a){return~a},"!":function(a){return!a}},y={"===":function(a,b){return a===b},"!==":function(a,b){return a!==b},"==":function(a,b){return a==b},"!=":function(a,b){return a!=b},">":function(a,b){return a>b},">=":function(a,b){return a>=b},"<":function(a,b){return b>a},"<=":function(a,b){return b>=a},"+":function(a,b){return a+b},"-":function(a,b){return a-b},"*":function(a,b){return a*b},"/":function(a,b){return a/b},"%":function(a,b){return a%b},"^":function(a,b){return a^b},"&&":function(a,b){return a&&b},"||":function(a,b){return a||b},"&":function(a,b){return a&b},"|":function(a,b){return a|b},"<<":function(a,b){return a<<b},">>":function(a,b){return a>>b},">>>":function(a,b){return a>>>b}};!u||"textContent"in u.createElement("div")?(b=function(a){return a.textContent},c=function(a,b){a.textContent=b}):(b=function(a){return a&&3===a.nodeType?a.nodeValue:a.innerText},c=function(a,b){a&&3===a.nodeType?a.nodeValue=b:a.innerText=b});var z,A,B,C,D,E,F=function(a,b,c){a.addEventListener?a.addEventListener(b,c):a.attachEvent("on"+b,c)},G=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c):a.detachEvent("on"+b,c)},H={},I=function(){var a=0;return function(){return a++}}(),J=function(a){return U(a)?R(a)?a.slice():db({},a):a},K=function(a,b){return a?void 0===b?a[a.length-1]:g.call(a,Math.max(a.length-b,0)):void 0},L=function(a,b,c){var d=!1;return a?k&&a.some===k?a.some(b,c):(ab(a,function(a,e,f){return d||(d=b.call(c,a,e,f))?H:void 0}),!!d):d},M=function(a,b){return g.call(a,void 0===b?1:b)},N=function(a,b,c){b=b||Y;var d=!0;return a?m&&a.every===m?a.every(b,c):(ab(a,function(a,e,f){return(d=d&&b.call(c,a,e,f))?void 0:H}),!!d):d},O=function(a,b,c){return b&&N(a,R)?i.apply(c,a):(ab(a,function(a){R(a)||X(a)?b?j.apply(c,a):O(a,b,c):c.push(a)}),c)},P=function(a,b){return O(a,b,[])},Q=function(a){return"[object Number]"===h.call(a)},R=Array.isArray||function(a){return"[object Array]"===h.call(a)},S=function(a){return"[object Function]"===h.call(a)},T=function(a){return"[object String]"===h.call(a)},U=function(a){return a===Object(a)},V=function(a){return!(!a||1!==a.nodeType)},W=function(a){return!!(a&&a.nodeType>0)},X=function(a){return"[object Arguments]"===h.call(a)},Y=function(a){return a},Z=function(a){return a?R(a)?g.call(a):X(a)?g.call(a):a.toArray&&S(a.toArray)?a.toArray():bb(a,Y):[]},$=e.hasOwnProperty,_=function(a,b){return $.call(a,b)},ab=function(a,b,c){var d,e,f;if(a)if(n&&a.forEach===n)a.forEach(b,c);else if(a.length===+a.length){for(d=0,f=a.length;f>d;d++)if(_(a,d)&&b.call(c,a[d],d,a)===H)return}else for(e in a)if(_(a,e)&&b.call(c,a[e],e,a)===H)return},bb=function(a,b,c){var d=[];return a?q&&a.map===q?a.map(b,c):(ab(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),a.length===+a.length&&(d.length=a.length),d):d},cb=function(a,b,c){var d=[];return a?o&&a.filter===o?a.filter(b,c):(ab(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d):d},db=function(a){return ab(g.call(arguments,1),function(b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}),a},eb=function(a,b,c){var d,e=a.length;for(d=c||0;e>d;d++)if(b(a[d],d))return d;return-1},fb=function(a,b){return a===b},gb=function(a,b,c,d){return d||c||!l||a.indexOf!==l?(d=d||fb,eb(a,function(a){return d(b,a)},c)):a.indexOf(b)},hb=function(a,b){return ib(a,gb(a,b))},ib=function(a,b){return b>=0?a.splice(b,1)[0]:b},jb=function(a,b,c){var d=arguments.length>2;return a||(a=[]),p&&a.reduce===p?d?a.reduce(b,c):a.reduce(b):(ab(a,function(a,d,e){c=b(c,a,d,e)}),c)},kb=function(a,b,c,d,e,f,g){var h=b[a],i=d[h]+1;return i=gb(c,h,i>e?i:e,g),0>i&&(i=f),d[h]=i,i},lb=function(a,b,c){var d,e,f,g={},h=0,i=0,j=0,k=a.length,l=b.length,m=new Array(l>k?l:k);if(0===l||0===k)return[];for(d=kb(0,a,b,g,h,l,c),f=0;k>f;f++)i=h===i?d:kb(f,a,b,g,h,l,c),d=kb(f+1,a,b,g,h,l,c),i>d?(f++,e=d):e=i,e===l||f===k?i=kb(f,a,b,g,h,l,c):(h=e,m[j]={item:a[f],indicies:[f,e]},j++);return m.slice(0,j)},mb=function(a,b,c){var d,e,f,g=J(b),h=a.length,i=b.length,j=[],k=0;if(0===i||0===h)return a;for(d=0;h>d;d+=1)if(f=a[d],e=gb(g,f,0,c),e>=0){if(ib(g,e),0===--i){j.push.apply(j,M(a,d+1));break}}else j[k]=f,k++;return j},nb=function(a,b,c){var d,e,f,g=J(b),h=a.length,i=b.length,j=[];for(d=0;h>d&&i>0;d++)f=a[d],e=gb(g,f,0,c),e>=0&&(j.push([f,ib(g,e)]),i--);return j},ob=function(a){var b=a[1].item;return{item:b,from:a[0].index,to:a[1].index,from_item:a[0].item,to_item:b}},pb=function(a,b){return{item:a,index:b}},qb=function(a){return{item:a.item,from:a.indicies[0],to:a.indicies[1]}},rb=function(a){return a.index},sb=function(a){return a.to},tb=function(a){return{from:a.index,from_item:a.item}},ub=function(a,b,c){var d=c||fb,e=function(a,b){return d(a?a.item:a,b?b.item:b)},f=bb(a,pb),g=bb(b,pb),h=bb(lb(a,b),qb),i=mb(f,h,e),j=mb(g,h,e),k=bb(nb(i,j,e),ob);j=mb(j,k,e),i=mb(i,k,e);var l=bb(j,rb),m=bb(k,sb),n=bb(h,sb),o=bb(b,function(b,c){var d,e;return(e=gb(l,c))>=0?(d=j[e],{to:c,to_item:b,item:b}):(e=gb(m,c))>=0?(d=k[e],{to:c,to_item:b,item:b,from:d.from,from_item:d.from_item}):(e=gb(n,c))>=0?(d=h[e],{to:c,to_item:b,item:b,from:d.from,from_item:a[d.from]}):void 0});return o.concat(bb(i,tb))},vb=function(a){return a.hasOwnProperty("from")},wb=function(a){return!vb(a)},xb=function(a){return a.hasOwnProperty("to")},yb=function(a){return!xb(a)},zb=function(a){return vb(a)&&xb(a)},Ab=function(a){return zb(a)&&a.from!==a.to},Bb=function(a,b){var c=vb(a),d=vb(b);return c&&d?a.from-b.from:d-c},Cb=function(a,b,c){var d=ub(a,b,c),e=J(d).sort(Bb),f=cb(d,wb),g=cb(e,yb).reverse(),h=cb(d,Ab),i=[];return ab(g,function(a){ib(e,a.from)}),ab(f,function(a){e.splice(a.to,0,a)}),ab(d,function(a,b){if(zb(a)&&e[b]!==a){var c=gb(e,a,b);e.splice(b,0,ib(e,c)),i.push({move_from:c,insert_at:b,item:a.item,from:a.from,to:a.to})}}),e=null,{added:f,removed:g,moved:i,index_changed:h,mapping:d}},Db=/-([a-z]|[0-9])/gi,Eb=/^-ms-/,Fb=function(a,b){return String(b).toUpperCase()},Gb=function(a){return a.replace(Eb,"ms-").replace(Db,Fb)},Hb=a.cjs,Ib=function(a,b){return R(a)?new A(db({value:a},b)):nd(a)?Ib.inputValue(a):C(a)?new z(a,b):U(a)&&!S(a)?new B(db({value:a},b)):new z(a,b)},Jb={stack:[],getValue:function(a){var b,c,d=this,e=Jb.stack,f=e.length;return f>0&&(b=e[f-1],c=d._outEdges[b._id],c?c.tstamp++:d._options.auto_add_outgoing_dependencies!==!1&&b._options.auto_add_incoming_dependencies!==!1&&a!==!1&&(d._outEdges[b._id]=b._inEdges[d._id]={from:d,to:b,tstamp:b._tstamp+1})),d._valid||(e[f]=d,d._valid=!0,d._tstamp++,d._options.cache_value!==!1?d._cached_value=d._options.literal?d._value:S(d._value)?d._value.call(d._options.context||d):Ib.get(d._value):S(d._value)&&d._value.call(d._options.context),e.length=f),d._cached_value},add_in_call_stack:function(a){a.in_call_stack=!0},nullify:function(a){var b,c,d,e,f,g,h,i,j,k=[a],l=1,m=!this._is_nullifying;for(m&&(this._is_nullifying=!0),b=0;l>b;b+=1)if(f=k[b],k[b]=!1,f._valid&&(f._valid=!1,e=!0,f._options.cache_value!==!1&&f._options.check_on_nullify===!0&&(g=f._options.equals||fb,h=f._cached_value,i=f.get(),g(h,i)&&(e=!1)),e)){j=f._changeListeners,ab(j,this.add_in_call_stack),this.nullified_call_stack.push.apply(this.nullified_call_stack,j),c=f._outEdges;for(d in c)if(_(c,d)){var n=c[d],o=n.to;n.tstamp<o._tstamp?(delete f._outEdges[d],delete o._inEdges[a._id]):(k[l]=o,l+=1)}}m&&(this.semaphore>=0&&this.nullified_call_stack.length>0&&this.run_nullified_listeners(),delete this._is_nullifying)},removeDependency:function(a,b){delete a._outEdges[b._id],delete b._inEdges[a._id]},semaphore:0,wait:function(){this.semaphore-=1},signal:function(){this.semaphore+=1,this.semaphore>=0&&this.nullified_call_stack.length>0&&this.run_nullified_listeners()},nullified_call_stack:[],running_listeners:!1,clearEdges:function(a,b){b!==!0&&this.wait();var c=a._id;ab(a._inEdges,function(b,d){var e=b.from;delete e._outEdges[c],delete a._inEdges[d]}),ab(a._outEdges,function(d,e){var f=d.to;b!==!0&&Jb.nullify(f),delete f._inEdges[c],delete a._outEdges[e]}),b!==!0&&this.signal()},run_nullified_listeners:function(){var b,c,d;if(!this.running_listeners){for(this.running_listeners=!0;this.nullified_call_stack.length>0;)if(b=this.nullified_call_stack.shift(),c=b.callback,d=b.context||a,b.in_call_stack=!1,Ib.__debug)c.apply(d,b.args);else try{c.apply(d,b.args)}catch(e){_(a,"console")&&a.console.error(e)}this.running_listeners=!1}},remove_from_call_stack:function(a){hb(this.nullified_call_stack,a)}};z=function(b,c){this._options=db({context:a},c),this._value=b,this._id=I(),this._outEdges={},this._inEdges={},this._changeListeners=[],this._tstamp=0,this._options.literal||!S(this._value)&&!C(this._value)?(this._valid=!0,this._cached_value=this._value):(this._valid=!1,this._cached_value=void 0)},function(a){var b=a.prototype;b.get=Jb.getValue,b.set=function(a){var b=this._value;if(this._value=a,this._options.literal||!S(a)){var c=this._options.equal||fb;c(b,a)||Jb.nullify(this)}else b!==a&&Jb.nullify(this);return this},b.setOption=function(a,b){return T(a)?this._options[a]=b:db(this._options,a),this.invalidate()},b.invalidate=function(){return Jb.nullify(this),this},b.isValid=function(){return this._valid},b.remove=function(a){return Jb.clearEdges(this,a),this._valid=!1,this._cached_value=void 0,this},b.destroy=function(a){return ab(this._changeListeners,function(a){a.in_call_stack&&Jb.remove_from_call_stack(a)}),this.remove(a),this._changeListeners=[],this},b.onChange=function(a,b){g.call(arguments,2);return this._changeListeners.push({callback:a,context:b,args:g.call(arguments,2),in_call_stack:!1}),this._options.run_on_add_listener!==!1&&this.get(!1),this},b.offChange=function(a,b){var c,d;for(d=this._changeListeners.length-1;d>=0;d-=1)if(c=this._changeListeners[d],c.callback===a&&(!b||c.context===b)){ib(this._changeListeners,d),c.in_call_stack&&Jb.remove_from_call_stack(c);break}return this},b.inFSM=function(a,b){return ab(b,function(b,c){a.on(c,function(){this.set(b)},this),a.is(c)&&this.set(b)},this),this},b.and=function(){var b=[this].concat(Z(arguments)),c=b.length;return new a(function(){for(var a,d=0;c>d;d++)if(!(a=Ib.get(b[d])))return!1;return a})},b.iif=function(b,c){var d=this;return new a(function(){return d.get()?Ib.get(b):Ib.get(c)})},b.or=function(){var b=[this].concat(Z(arguments)),c=b.length;return new a(function(){for(var a,d=0;c>d;d++)if(a=Ib.get(b[d]))return a;return!1})};var c=function(b){return function(){var c=[this].concat(Z(arguments));return new a(function(){return b.apply(this,bb(c,Ib.get))})}},d=function(a,b){return a?a[b]:void 0};b.prop=c(function(a){return jb(M(arguments),d,a)}),b.toInt=c(function(){return parseInt.apply(this,arguments)}),b.toFloat=c(function(){return parseFloat.apply(this,arguments)}),b.add=c(function(){return jb(arguments,y["+"],0)}),b.sub=c(function(a){return jb(M(arguments),y["-"],a)}),b.mul=c(function(a){return jb(M(arguments),y["*"],a)}),b.div=c(function(a){return jb(M(arguments),y["/"],a)}),ab(["abs","acos","asin","atan","atan2","cos","max","min","sin","tan","pow","round","floor","ceil","sqrt","log","exp"],function(a){b[a]=c(s(Math[a],Math))}),ab({u:{pos:"+",neg:"-",not:"!",bitwiseNot:"~"},bi:{eqStrict:"===",neqStrict:"!==",eq:"==",neq:"!=",gt:">",ge:">=",lt:"<",le:"<=",xor:"^",bitwiseAnd:"&",bitwiseOr:"|",mod:"%",rightShift:">>",leftShift:"<<",unsignedRightShift:">>>"}},function(a,d){var e="u"===d?x:y;ab(a,function(a,d){b[d]=c(e[a])})}),b.typeOf=c(function(a){return typeof a}),b.instanceOf=c(function(a,b){return a instanceof b})}(z),C=function(a){return a instanceof z},db(Ib,{constraint:function(a,b){return new z(a,b)},Constraint:z,isConstraint:C,inFSM:function(a,b){return(new z).inFSM(a,b)},get:function(a,b){return C(a)?a.get(b):D(a)?a.toArray():E(a)?a.toObject():a},wait:s(Jb.wait,Jb),signal:s(Jb.signal,Jb),removeDependency:Jb.removeDependency,arrayDiff:Cb,version:"0.9.4-beta",toString:function(){return"ConstraintJS v"+Ib.version},__debug:!1,noConflict:_(a,"cjs")?function(){return a.cjs===Ib&&(a.cjs=Hb),Ib}:function(){return delete a.cjs,Ib}});var Kb=function(a){return Q(a)&&Math.round(a)===a&&a>=0};A=function(a){a=db({equals:fb,value:[]},a),this._value=bb(a.value,function(a){return new z(a,{literal:!0})}),this._unsubstantiated_items=[],this.$len=new z(this._value.length),this.$equality_check=new z(a.equals,{literal:!0})},function(b){var c=b.prototype;b.BREAK={};var d=function(a,b){var c=a._value[b];return void 0===c&&(c=new z(void 0,{literal:!0}),a._unsubstantiated_items[b]=c),c.get()},e=function(a,b,c){Ib.wait();var d=a._value[b];if(void 0===d&&a._unsubstantiated_items[b]&&(d=a._value[b]=a._unsubstantiated_items[b],delete a._unsubstantiated_items[b]),C(d)){{d.get()}d.set(c)}else a._value[b]=new z(c,{literal:!0});return h(a),Ib.signal(),c},f=function(a,b){var c;for(Ib.wait();a._value.length>0;){c=a._value.pop();{a._value.length}C(c)&&c.destroy(b)}return h(a),Ib.signal(),this},h=function(a){a.$len.set(a._value.length)};c.setEqualityCheck=function(a){return this.$equality_check.set(a),this},c.forEach=function(c,e){var f,g=this.length();for(e=e||a,f=0;g>f;f+=1)if(c.call(e,d(this,f),f)===b.BREAK)return this;return this},c.map=function(b,c){var d=[];return c=c||a,this.forEach(function(a,e){d[e]=b.call(c,a,e)}),d},c.setValue=function(a){return Ib.wait(),f(this),this.push.apply(this,a),Ib.signal(),this},c.item=function(a,b){return 0===arguments.length?this.toArray():1===arguments.length?d(this,a):arguments.length>1?e(this,a,b):void 0},c.destroy=function(a){f(this,a),this.$len.destroy(a)},c.length=function(){return this.$len.get()},c.push=function(){var a,b=arguments.length,c=this._value.length;for(Ib.wait(),a=0;b>a;a++)e(this,c+a,arguments[a]);return Ib.signal(),this.length()},c.pop=function(){var a,b=this._value.pop();return Ib.wait(),C(b)&&(a=b.get(),b.destroy()),h(this),Ib.signal(),a},c.toArray=function(){return this.map(Y)},c.indexWhere=function(a,b){var c,d,e=this.length();for(b=b||this,c=0;e>c;c+=1)if(d=this._value[c],a.call(b,d.get(),c))return c;return-1},c.lastIndexWhere=function(a,b){var c,d,e=this.length();for(b=b||this,c=e-1;c>=0;c-=1)if(d=this._value[c],a.call(b,d.get(),c))return c;return-1},c.indexOf=function(a,b){b=b||this.$equality_check.get();var c=function(c){return b(c,a)};return this.indexWhere(c)},c.lastIndexOf=function(a,b){b=b||this.$equality_check.get();var c=function(c){return b(c,a)};return this.lastIndexWhere(c)},c.some=function(a,b){return this.indexWhere(a,b)>=0},c.every=function(a,c){var d=!0;return this.forEach(function(){return a.apply(c,arguments)?void 0:(d=!1,b.BREAK)}),d},c.splice=function(a,b){var c;if(Q(b)||(b=0),!Kb(a)||!Kb(b))throw new Error("index and howmany must be positive integers");var f=g.call(arguments,2),i=f.length;Ib.wait();var j=i-b,k=bb(this._value.slice(a,a+b),function(a){return a?a.get():void 0});if(0>j){var l=this._value.length,m=a+i,n=l+j;for(c=a;m>c;c+=1)e(this,c,f[c-a]);for(;n>c;c+=1)e(this,c,d(this,c-j));for(;l>c;c+=1){var o=this._value.pop();C(o)&&o.destroy()}}else for(c=this._value.length+j-1;c>=a;c-=1)a+i>c?e(this,c,f[c-a]):e(this,c,d(this,c-j));return 0!==j&&h(this),Ib.signal(),k},c.shift=function(){var a=this.splice(0,1);return a[0]},c.unshift=function(){return this.splice.apply(this,[0,0].concat(Z(arguments))),this.length()},c.concat=function(){var a=bb(arguments,function(a){return D(a)?a.toArray():a}),b=this.toArray();return b.concat.apply(b,a)},c.slice=function(){var a=this._value.slice.apply(this._value,arguments);return bb(a,function(a){return a?a.get():void 0})},c.itemConstraint=function(a){return new z(function(){return this.item(Ib.get(a))},{context:this})},ab(["filter","join","sort","reverse","toString"],function(a){c[a]=function(){var b=this.toArray();return b[a].apply(b,arguments)}})}(A),D=function(a){return a instanceof A},db(Ib,{array:function(a){return new A(a)},ArrayConstraint:A,isArrayConstraint:D});var Lb=function(a){return a+""},Mb=function(a){return function(b){return b[a]()}};B=function(a){a=db({hash:Lb,valuehash:!1,equals:fb,valueequals:fb,value:{},keys:[],values:[],literal_values:!1,create_unsubstantiated:!0},a),ab(a.value,function(b,c){a.keys.push(c),a.values.push(b)},this),this._default_literal_values=!!a.literal_values,this.$equality_check=new z(a.equals,{literal:!0}),this.$vequality_check=new z(a.valueequals,{literal:!0}),this._hash=T(a.hash)?Mb(a.hash):a.hash,this._create_unsubstantiated=a.create_unsubstantiated,this._khash={},a.valuehash?(this._vhash={},this._valuehash=S(a.valuehash)?a.valuehash:T(a.valuehash)?Mb(a.valuehash):Lb):this._vhash=!1;var b=this._default_literal_values;this._ordered_values=bb(a.keys,function(c,d){var e=a.values[d],f={key:new z(c,{literal:!0}),value:new z(e,{literal:b}),index:new z(d,{literal:!0})},g=this._hash(c),h=this._khash[g];if(h?h.push(f):this._khash[g]=[f],this._vhash){var i=this._valuehash(e),j=this._vhash[i];j?j.push(f):this._vhash[i]=[f]}return f},this),this._unsubstantiated_values={},this.$keys=new z(function(){var a=[];return this.forEach(function(b,c,d){a[d]=c}),a},{context:this}),this.$values=new z(function(){var a=[];return this.forEach(function(b,c,d){a[d]=b}),a},{context:this}),this.$entries=new z(function(){var a=[];return this.forEach(function(b,c,d){a[d]={key:c,value:b}}),a},{context:this}),this.$size=new z(function(){return this._ordered_values.length},{context:this})},function(a){a.BREAK=A.BREAK;var b=a.prototype,c=function(a,b,c){var d=this._hash(a),e={h:d,hv:!1,i:-1,ui:-1,uhv:!1},f=this.$equality_check.get(),g=function(b){return f(b.key.get(),a)},h=this._khash[d];if(h){var i=eb(h,g);if(e.hv=h,i>=0)return e.i=i,e}if(b!==!1){var j=this._unsubstantiated_values[d],k=-1;if(j&&(e.uhv=j,k=eb(j,g),k>=0))return e.ui=k,e;if(c===!0){var l=this._default_literal_values,m={key:new z(a,{literal:!0}),value:new z(void 0,{literal:l}),index:new z(-1,{literal:!0})};j?(k=j.length,j[k]=m):(k=0,this._unsubstantiated_values[d]=j=[m])}e.uhv=j||!1,e.ui=k}return e},d=function(a,b,c,d,f){var g,h,i,j,k=a.i,l=a.hv,m=a.h;if(k>=0){if(j=l[k],this._vhash){var n=j.value.get(),o=this._valuehash(n),p=this._vhash[o];if(h=this._valuehash(c),p){var q=p.length;for(g=0;q>g;g+=1)if(p[g]===j){p.splice(g,1),0===p.length&&delete this._vhash[o];break}}i=this._vhash[h],i?i.push(j):this._vhash[h]=[j]}if(j.value.set(c),Kb(d)){var r=j.index.get();if(r!==d){this._ordered_values.splice(r,1),this._ordered_values.splice(d,0,j);var s=Math.min(r,d),t=Math.max(r,d);for(g=s;t>=g;g+=1)e(this._ordered_values[g],g);this.$keys.invalidate()}}}else{Kb(d)||(d=this._ordered_values.length);var u=a.ui;if(u>=0){var v=a.uhv,w=v[u];v.splice(u,1),0===v.length&&delete this._unsubstantiated_values[m],j=w,j.value.set(c),j.index.set(d)}else j={key:new z(b,{literal:!0}),value:new z(c,{literal:void 0===f?this._default_literal_values:!!f}),index:new z(d,{literal:!0})};for(l?l.push(j):l=this._khash[m]=[j],this._vhash&&(h=this._valuehash(c),i=this._vhash[h],i?i.push(j):this._vhash[h]=[j]),this._ordered_values.splice(d,0,j),g=d+1;g<this._ordered_values.length;g+=1)e(this._ordered_values[g],g);this.$size.invalidate(),this.$keys.invalidate()}this.$values.invalidate(),this.$entries.invalidate()},e=function(a,b){a.index.set(b)},f=function(a,b){ab(a,function(a){a.key.destroy(b),a.value.destroy(b),a.index.destroy(b)})},g=function(a,b){this._ordered_values[a];f(this._ordered_values.splice(a,1),b),b!==!0&&this.$size.invalidate()};b.keys=function(){return this.$keys.get()},b.values=function(){return this.$values.get()},b.entries=function(){return this.$entries.get()},b.size=function(){return this.$size.get()},b.isEmpty=function(){return 0===this.size()},b.put=function(a,b,e,f){Ib.wait();var g=c.call(this,a,!0,!1);return d.call(this,g,a,b,e,f),Ib.signal(),this},b.remove=function(a){var b,d,f,h,i,j=c.call(this,a,!1,!1),k=j.i,l=j.hv;if(k>=0){if(Ib.wait(),d=l[k],f=d.index.get(),l.splice(k,1),0===l.length&&delete this._khash[j.h],this._vhash&&(h=this._valuehash(d.value.get()),i=this._vhash[h])){var m=i.length;for(b=0;m>b;b+=1)if(i[b]===d){i.splice(b,1),0===i.length&&delete this._vhash[h];break}}for(g.call(this,f),b=f;b<this._ordered_values.length;b+=1)e(this._ordered_values[b],b);this.$size.invalidate(),this.$keys.invalidate(),this.$values.invalidate(),this.$entries.invalidate(),Ib.signal()}return this},b.get=function(a){var b=c.call(this,a,!0,this._create_unsubstantiated),d=b.i,e=b.hv;if(d>=0){var f=e[d];return f.value.get()}if(this._create_unsubstantiated){var g=b.uhv[b.ui];return g.value.get()}return void 0},b.item=function(a,b,c){return 0===arguments.length?this.toObject():1===arguments.length?this.get(a):this.put(a,b,c)},b.itemConstraint=function(a){return new z(function(){return this.get(Ib.get(a))},{context:this})},b.clear=function(a){if(this.size()>0){for(Ib.wait();this._ordered_values.length>0;)g.call(this,0,a);ab(this._khash,function(a,b){delete this._khash[b]},this),this._vhash&&ab(this._vhash,function(a,b){delete this._vhash[b]},this),a||(this.$keys.invalidate(),this.$values.invalidate(),this.$entries.invalidate(),this.$size.invalidate()),Ib.signal()}return this},b.forEach=function(b,c){var d,e,f=this.size(),g=this._ordered_values.slice();for(c=c||this,d=0;f>d&&(e=g[d],!e||b.call(c,e.value.get(),e.key.get(),e.index.get())!==a.BREAK);d+=1);return this},b.setEqualityCheck=function(a){return this.$equality_check.set(a),this},b.setValueEqualityCheck=function(a){return this.$vequality_check.set(a),this},b.setHash=function(a){Ib.wait(),this._hash=T(a)?Mb(a):a,this._khash={},ab(this._ordered_values,function(a){var b=a.key.get(),c=this._hash(b),d=this._khash[c];d?d.push(a):this._khash[c]=[a]},this);var b={};return ab(this._unsubstantiated_values,function(a){ab(a,function(a){var c=a.key.get(),d=this._hash(c),e=this.new_unsubstatiated_values[d];e?e.push(a):b[d]=[a]},this)},this),this._unsubstantiated_values=b,Ib.signal(),this},b.setValueHash=function(a){return this._valuehash=T(a)?Mb(a):a,this._vhash={},this._valuehash&&ab(this._ordered_values,function(a){var b=a.value.get(),c=this._valuehash(b),d=this._vhash[c];d?d.push(a):this._vhash[c]=[a]},this),this},b.indexOf=function(a){var b=c.call(this,a,!0,this._create_unsubstantiated),d=b.i,e=b.hv;if(d>=0){var f=e[d];return f.index.get()}if(b.ui>=0){var g=b.uhv[b.ui];return g.index.get()}return-1},b.getOrPut=function(a,b,e,f,g){{var h,i,j,k=c.call(this,a,!0,!1),l=k.i,m=k.hv;k.h}return l>=0?(j=m[l],j.value.get()):(Ib.wait(),h=e||this,i=b.call(h,a),d.call(this,k,a,i,f,g),Ib.signal(),i)},b.has=function(a){var b=c.call(this,a,!0,this._create_unsubstantiated),d=b.i;if(d>=0)return!0;if(this._create_unsubstantiated){var e=b.uhv[b.ui];return e.index.get(),!1}return!1},b.moveIndex=function(a,b){var c;Ib.wait();var d=this._ordered_values[a];this._ordered_values.splice(a,1),this._ordered_values.splice(b,0,d);var f=Math.min(a,b),g=Math.max(a,b);for(c=f;g>=c;c+=1)e(this._ordered_values[c],c);return this.$keys.invalidate(),this.$values.invalidate(),this.$entries.invalidate(),Ib.signal(),this},b.move=function(a,b){var d=c.call(this,a,!1,!1),e=d.i;if(e>=0){var f=d.hv[e];this.moveIndex(f.index.get(),b)}return this},b.keyForValue=function(b,c){c=c||this.$vequality_check.get();var d;if(this._vhash){var e=this._valuehash(b),f=this._vhash[e];if(f){var g=f.length;for(d=0;g>d;d+=1){var h=f[d];if(c(h.value.get(),b))return h.key.get()}}return void 0}var i;return this.forEach(function(d,e){return c(b,d)?(i=e,a.BREAK):void 0}),i},b.destroy=function(a){Ib.wait(),this.clear(a),this.$equality_check.destroy(a),this.$vequality_check.destroy(a),this.$keys.destroy(a),this.$values.destroy(a),this.$entries.destroy(a),this.$size.destroy(a),Ib.signal()},b.toObject=function(a){var b={};return a=a||Y,this.forEach(function(c,d){b[a(d)]=c}),b}}(B),E=function(a){return a instanceof B},db(Ib,{map:function(a,b){return new B(a,b)},MapConstraint:B,isMapConstraint:E}),db(Ib,{liven:function(b,c){c=db({context:a,run_on_create:!0,pause_while_running:!1,on_destroy:!1},c);var d,e=new z(b,{context:c.context,cache_value:!1,auto_add_outgoing_dependencies:!1,run_on_add_listener:!!c.run_on_create}),f=!1,g=function(a){c.on_destroy&&c.on_destroy.call(c.context,a),e.destroy(a)},h=function(){return f===!1?(f=!0,e.offChange(d),!0):!1},i=function(){return f===!0?(f=!1,e.onChange(d),!0):!1};d=function(){c.pause_while_running&&h(),e.get(),c.pause_while_running&&i()},e.onChange(d);var j={destroy:g,pause:h,resume:i,run:function(a){return d(a),this},_constraint:e};return j}});var Nb=function(){var a,b=arguments.length,c="";for(a=0;b>a;a+=1)c+=arguments[a];return c},Ob=function(a,b){var c,d=a.length;if(d===b.length){for(c=0;d>c;c+=1){var e=a[c],f=b[c];if(e!==f)return!1}return!0}return!1};db(Ib,{memoize:function(b,c){c=db({hash:Nb,equals:Ob,context:a,literal_values:!0},c);var d=new B({hash:c.hash,equals:c.equals,literal_values:c.literal_values}),e=function(){var a=Z(arguments),e=d.getOrPut(a,function(){return new z(function(){return b.apply(c.context,a)})});return e.get()};return e.destroy=function(a){d.forEach(function(b){b.destroy(a)}),d.destroy(a)},e.each=function(a){d.forEach(a)},e}});var Pb=function(a){if(W(a))return a;var b=u.createTextNode(a);return b},Qb=function(a,b,c){var d=b.childNodes;if(d.length<=c)b.appendChild(a);else{var e=d[c];b.insertBefore(a,e)}},Rb=function(a){var b=a.parentNode;null!==b&&b.removeChild(a)},Sb=function(a,b){var c,d=a.childNodes;d.length>b&&(c=d[b],Rb(c))},Tb=function(a,b,c){var d=a.childNodes;if(d.length>c){var e=d[c];a&&(b>c&&b++,Qb(e,a,b))}},Ub=function(b){return _(a,"jQuery")?b instanceof a.jQuery:!1},Vb=a.NodeList||!1,Wb=Vb?function(a){return a instanceof Vb}:function(){return!1},Xb=function(b){return R(b)?b:C(b)?Xb(b.get()):D(b)?b.toArray():E(b)?b.values():Ub(b)?a.jQuery.makeArray(b):Wb(b)?Z(b):[b]},Yb=function(a){var b,c,d=a.targets,e=a.onAdd,f=a.onRemove,g=a.onMove,h=a.setter,i=a.getter,j=a.init_val,k=[],l=a.onDestroy,m=function(){this._timeout_id=!1;var a=cb(Xb(d),W);if(e||f||g){var i=Cb(k,a);ab(f&&i.removed,function(a){f(a.from_item,a.from)}),ab(e&&i.added,function(a){e(a.item,a.to)}),ab(g&&i.moved,function(a){g(a.item,a.to_index,a.from_index)}),k=a}ab(a,function(a){h(a,b,c)}),c=b};this.onDestroy=l,this._throttle_delay=!1,this._timeout_id=!1,c=S(j)?j(Xb(d[0])):j,this.$live_fn=Ib.liven(function(){b=i(),this._throttle_delay?this._timeout_id||(this._timeout_id=v(s(m,this),this._throttle_delay)):m.call(this)},{context:this})};!function(a){var b=a.prototype;b.pause=function(){return this.$live_fn.pause(),this},b.resume=function(){return this.$live_fn.resume(),this},b.throttle=function(a){return this._throttle_delay=a>0?a:!1,this._timeout_id&&!this._throttle_delay&&(w(this._timeout_id),this._timeout_id=!1),this.$live_fn.run(),this},b.destroy=function(){this.$live_fn.destroy(),this.onDestroy&&this.onDestroy()}}(Yb);var Zb=function(a,b,c){return function(d){var e=g.call(arguments,1),f=Ib(function(){return a(e)}),h=new Yb({targets:d,getter:s(f.get,f),setter:b,init_val:c,onDestroy:function(){f.destroy()}});return h}},$b=function(a){return Zb(function(a){return bb(a,Ib.get).join("")},function(b,c){a(b,c)})},_b=function(a){return function(b){var c,d=g.call(arguments,1);if(0!==d.length){1===d.length?c=d[0]:d.length>1&&(c={},c[d[0]]=d[1]);var e=new Yb({targets:b,setter:function(b,c){ab(c,function(c,d){a(b,d,c)})},getter:function(){if(E(c))return c.toObject();var a={};return ab(c,function(b,c){a[c]=Ib.get(b)}),a}});return e}}},ac=$b(function(a,b){c(a,b)}),bc=$b(function(a,b){a.innerHTML=b}),cc=$b(function(a,b){a.val=b}),dc=Zb(function(a){return P(bb(a,Ib.get),!0)},function(a,b,c){var d=Cb(c,b),e=" "+a.className+" ";ab(d.removed,function(a){e=e.replace(" "+a.from_item+" "," ")}),e+=bb(d.added,function(a){return a.item}).join(" "),e=t(e),a.className=e},[]),ec=Zb(function(a){var b=bb(a,Ib.get);return bb(P(b,!0),Pb)},function(a,b,c){var d=Cb(c,b);ab(d.removed,function(b){Sb(a,b.from)}),ab(d.added,function(b){Qb(b.item,a,b.to)}),ab(d.moved,function(b){Tb(a,b.to_index,b.from_index)})},function(a){return Z(a.childNodes)}),fc=_b(function(a,b,c){a.style[Gb(b)]=c}),gc=_b(function(a,b,c){a.setAttribute(b,c)}),hc=["keyup","input","paste","propertychange","change"],ic=function(a){var b;V(a)?(a=[a],b=!1):b=!0;var c=Ib(function(){return b?bb(a,function(a){return a.value}):a[0].value}),d=(a.length,s(c.invalidate,c)),e=function(){ab(hc,function(b){ab(a,function(a){F(a,b,d)})})},f=function(){ab(hc,function(b){ab(a,function(a){G(a,b,d)})})},g=c.destroy;return c.destroy=function(){f(),g.call(c)},e(),c};db(Ib,{bindText:ac,bindHTML:bc,bindValue:cc,bindChildren:ec,bindAttr:gc,bindCSS:fc,bindClass:dc,inputValue:ic,Binding:Yb});var jc=function(a,b){this._fsm=a,this._name=b,this._id=I()};!function(a){var b=a.prototype;b.getName=function(){return this._name},b.id=function(){return this._id}}(jc);var kc=function(a,b,c,d){this._fsm=a,this._from=b,this._to=c,this._name=d,this._id=I()};!function(a){var b=a.prototype;b.getFrom=function(){return this._from},b.getTo=function(){return this._to},b.getName=function(){return this._name},b.getFSM=function(){return this._fsm},b.id=function(){return this._id},b.run=function(){var a=this.getFSM();if(a.is(this.getFrom())){var b=Z(arguments);b.unshift(this.getTo(),this),a._setState.apply(a,b)}}}(kc);var lc=function(a){this._state_name=a};!function(a){var b=a.prototype;b.matches=function(a){return this._state_name===a||a instanceof jc&&this._state_name===a.getName()}}(lc);var mc=function(){};!function(a){var b=a.prototype;b.matches=function(a){return!(a instanceof kc)}}(mc);var nc=function(a,b,c){this.is_pre=a,this.from_state_selector=b,this.to_state_selector=c};!function(a){var b=a.prototype;b.matches=function(a,b){if(a instanceof kc&&this.is_pre===b){var c=a.getFrom(),d=a.getTo();return this.from_state_selector.matches(c)&&this.to_state_selector.matches(d)}return!1}}(nc);var oc=function(){this.selectors=Z(arguments)};!function(a){var b=a.prototype;b.matches=function(){var a=arguments;return L(this.selectors,function(b){return b.matches.apply(b,a)})}}(oc);var pc=function(a){return"*"===a?new mc:new lc(a)},qc=function(a){var b=bb(a.split(","),function(a){return t(a)});if(1===b.length)return pc(b[0]);var c=bb(b,pc);return new oc(c)},rc=function(a,b,c){var d,e,f=qc(a),g=qc(c);return"<->"===b?(d=new nc(!1,f,g),e=new nc(!1,g,f),new oc(d,e)):">-<"===b?(d=new nc(!0,f,g),e=new nc(!0,g,f),new oc(d,e)):"->"===b?new nc(!1,f,g):">-"===b?new nc(!0,f,g):"<-"===b?new nc(!1,g,f):"-<"===b?new nc(!0,g,f):null},sc=/^([\sa-zA-Z0-9,\-_*]+)((<->|>-<|->|>-|<-|-<)([\sa-zA-Z0-9,\-_*]+))?$/,tc=function(a){var b=a.match(sc);if(null===b)return null;if(b[2]){var c=b[1],d=b[3],e=b[4];return rc(c,d,e)}var f=b[1];return qc(f)},uc=0,vc=function(b,c,d){this._context=d||a,this._selector=b,this._callback=c,this._id=uc++};!function(a){var b=a.prototype;b.interested_in=function(){return this._selector.matches.apply(this._selector,arguments)},b.run=function(){this._callback.apply(this._context,arguments)}}(vc);var wc=function(){this._states={},this._transitions=[],this._curr_state=null,this._listeners=[],this._chain_state=null,this._did_transition=!1,this.state=Ib(function(){return this._curr_state?this._curr_state._name:null},{context:this}),this.addState.apply(this,P(arguments,!0))};!function(a){var b=a.prototype,c=function(a,b){return a._states[b]};b.addState=function(){var a;return ab(arguments,function(b){a=c(this,b),a||(a=this._states[b]=new jc(this,b),null===this._curr_state&&(this._curr_state=a))},this),a&&(this._chain_state=a),this},b.getState=function(){return this.state.get()},b.addTransition=function(a,b,c){var d,e,f,g,h=!1;if(0===arguments.length)throw new Error("addTransition expects at least one argument");return 1===arguments.length?(h=!0,d=this._chain_state,e=a):2===arguments.length?S(b)||b instanceof xc?(d=this._chain_state,e=a,g=b):(d=a,e=b,h=!0):(d=a,e=b,g=c),T(d)&&!_(this._states,d)&&(this._states[d]=new jc(this,d)),T(e)&&!_(this._states,e)&&(this._states[e]=new jc(this,e)),f=new kc(this,d,e),this._transitions.push(f),h?s(f.run,f):(g instanceof xc?g._addTransition(f):g.call(this,s(f.run,f),this),this)
},b._setState=function(a,b,d){var e=this.getState(),f=T(a)?c(this,a):a,g=this._listeners.length>0?[d,b,f,e].concat(M(arguments,3)):!1;if(!f)throw new Error("Could not find state '"+a+"'");this.did_transition=!0,ab(this._listeners,function(a){a.interested_in(b,!0)&&a.run.apply(a,g)}),this._curr_state=f,this.state.invalidate(),ab(this._listeners,function(a){(a.interested_in(b,!1)||a.interested_in(f))&&a.run.apply(a,g)})},b.destroy=function(){this.state.destroy(),this._states={},this._transitions=[],this._curr_state=null},b.startsAt=function(a){var b=c(this,a);return b||(b=this._states[a]=new jc(this,a)),this.did_transition||(this._curr_state=b),this._chain_state=b,this},b.is=function(a){var b=this.getState();return null===b?!1:b===(T(a)?a:a.getName())},b.on=b.addEventListener=function(a,b,c){var d;if(T(a)){if(d=tc(a),null===d)throw new Error("Unrecognized format for state/transition spec.")}else d=a;var e=new vc(d,b,c);return this._listeners.push(e),this},b.off=b.removeEventListener=function(a){return this._listeners=cb(this._listeners,function(b){return b.callback!==a}),this}}(wc),db(Ib,{FSM:wc,fsm:function(){return new wc(arguments)},isFSM:function(a){return a instanceof wc}});var xc=function(a,b,c,d){this._listeners=[],this._transitions=[],this._on_add_transition=c,this._on_remove_transition=d,this._live_fns={},a&&a._listeners.push({event:this,filter:b})};!function(b){var c=b.prototype;c.guard=function(a){return new xc(this,a)},c._addTransition=function(a){this._transitions.push(a),this._on_add_transition&&(this._live_fns[a.id()]=this._on_add_transition(a))},c._removeTransition=function(a){if(hb(this._transitions,a)){this._on_remove_transition&&this._on_remove_transition(a);var b=a.id();this._live_fns[b].destroy(),delete this._live_fns[b]}},c._fire=function(){var b=arguments;ab(this._transitions,function(a){a.run.apply(a,b)}),ab(this._listeners,function(c){var d=c.event,e=c.filter;(!e||e.apply(a,b))&&d._fire.apply(d,b)})}}(xc);var yc=function(b){return b===a||V(b)},zc=function(a){return bb(a.split(" "),t)},Ac="timeout";db(Ib,{CJSEvent:xc,on:function(b){var c=arguments.length>1?M(arguments):a,d=new xc(!1,!1,function(a){var d=[],e=!1,f=[],g=s(a.run,a),h=a.getFSM(),i=a.getFrom(),j=new lc(i),k=new nc(!0,j,new mc),l=function(){ab(f,function(a){if(a===Ac){e&&(w(e),e=!1);var b=Ib.get(c[0]);(!Q(b)||0>b)&&(b=0),e=v(g,b)}else ab(d,function(b){F(b,a,g)})})},m=function(){ab(f,function(a){ab(d,function(b){a===Ac?e&&(w(e),e=!1):G(b,a,g)})})},n=Ib.liven(function(){m(),f=zc(Ib.get(b)),d=cb(Xb(c),yc),h.on(j,l).on(k,m),h.is(i)&&l()});return n});return d}});var Bc=function(a){var b={};return ab(a.split(","),function(a){b[a]=!0}),b},Cc=/^<([\-A-Za-z0-9_]+)((?:\s+[a-zA-Z0-9_\-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,Dc=/^<\/([\-A-Za-z0-9_]+)[^>]*>/,Ec=/^\{\{([#=!>|{\/])?\s*((?:(?:"[^"]*")|(?:'[^']*')|[^\}])*)\s*(\/?)\}?\}\}/,Fc=/([\-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^\/>\s]+)))?/g,Gc="hb",Hc="html",Ic=Bc("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),Jc=Bc("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),Kc=Bc("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),Lc=Bc("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),Mc=Bc("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),Nc=Bc("script,style"),Oc={state:{parent:["fsm"]},elif:{parent:["if"]},"else":{parent:["if","each"]}},Pc={elif:{when_open_sibling:["elif","else"]},"else":{when_close_parent:["if","each"],when_open_sibling:[]},state:{when_open_sibling:["state"]}},Qc={elif:{follows:["elif"],or_parent:["if"]},"else":{follows:["elif"],or_parent:["if","each"]},state:{follows:["state"],or_parent:["fsm"]}},Rc=function(a,b){function c(a,c,e,f){if(c=c.toLowerCase(),Jc[c])for(;n.last()&&Kc[n.last()];)d("",n.last());if(Lc[c]&&n.last()==c&&d("",c),f=Ic[c]||!!f,f||n.push({type:Hc,tag:c}),b.startHTML){var g=[];e.replace(Fc,function(a,b){var c=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:Mc[b]?b:"";g.push({name:b,value:c,escaped:c.replace(/(^|[^\\])"/g,'$1\\"')})}),b.startHTML(c,g,f)}}function d(a,b){g(b,Hc)}function e(){var a,b;for(a=n.length-1;a>=0;a--)if(b=n[a],b.type===Gc)return b;return void 0}function f(a,c,d){var f,h,i=Gd(d);switch(i.type===vd?i.body.length>0&&i.body[0].type===wd&&(h=i.body[0].name):i.type===wd&&(h=i.name),c){case"{":b.startHB(h,i,!0,!0);break;case">":b.partialHB(h,i);break;case"#":if(f=e(),f&&_(Pc,f.tag)){var k=Pc[f.tag];gb(k.when_open_sibling,h)>=0&&(g(f.tag,Gc),f=e())}if(_(Oc,h)){var l=Oc[h];if(!f||gb(l.parent,f.tag)<0)throw new Error("'"+h+"' must be inside of a '"+l.parent+"' block")}if(_(Qc,h)){var m=Qc[h];if(gb(m.follows,j)<0&&(!m.or_parent||gb(m.or_parent,f.tag)<0)){var o="'"+h+"' must follow a '"+m.follows[0]+"'";throw m.or_parent&&(o+=" or be inside of a '"+m.or_parent[0]+"' tag"),new Error(o)}}n.push({type:Gc,tag:h}),b.startHB(h,i,!1);break;case"/":g(h,Gc);break;case"!":break;default:b.startHB(h,i,!0,!1)}}function g(a,c){var d,e,f;for(e=n.length-1;e>=0&&(n[e].type!==c||n[e].tag!==a);e-=1);if(e>=0){for(d=n.length-1;d>=e;d--)f=n[d],f.type===Gc?b.endHB&&b.endHB(f.tag):b.endHTML&&b.endHTML(f.tag);n.length=e}c===Gc&&(j=a)}var h,i,j,k,l,m,n=[],o=a;n.last=function(){return this[this.length-1]};for(var p=function(a,c){return c=c.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)\]\]>/g,"$1"),b.chars&&b.chars(c),""};a;){if(l=!0,n.last()&&Nc[n.last()])a=a.replace(new RegExp("(.*)</"+n.last()+"[^>]*>"),p),d("",n.last());else if(0===a.indexOf("<!--")?(k=a.indexOf("-->"),k>=0&&(b.HTMLcomment&&b.HTMLcomment(a.substring(4,k)),a=a.substring(k+3),l=!1)):0===a.indexOf("</")?(m=a.match(Dc),m&&(a=a.substring(m[0].length),m[0].replace(Dc,d),l=!1)):0===a.indexOf("<")?(m=a.match(Cc),m&&(a=a.substring(m[0].length),m[0].replace(Cc,c),l=!1)):0===a.indexOf("{{")&&(m=a.match(Ec),m&&(a=a.substring(m[0].length),m[0].replace(Ec,f),l=!1)),l){h=a.indexOf("<"),i=a.indexOf("{{"),k=0>h?i:0>i?h:Math.min(h,i);var q=0>k?a:a.substring(0,k);a=0>k?"":a.substring(k),b.chars(q)}if(a==o)throw new Error("Parse Error: "+a);o=a}d()},Sc=function(a){return"unary_hb"===a.type&&a.literal},Tc=function(a){return eb(a,Sc)>=0},Uc=function(a){return a.outerHTML||function(a){var b,c=document.createElement("div");return c.appendChild(a.cloneNode(!0)),b=c.innerHTML,c=null,b}(a)},Vc=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},Wc=function(a,b,c,d,e){return a?a[b.computed?_c(b,c,d,e):b.name]:void 0},Xc={},Yc=function(a){return a.type===vd?a.body[0]:a},Zc=function(a){return{type:vd,body:a.type===vd?M(a.body):[]}},$c=function(a){return a.node||a.getNodes()},_c=function(b,c,d,e){var f,g,h,i,j,k,l;if(b)switch(b.type){case zd:return Ib.get(K(d).this_exp);case yd:return b.value;case Bd:return f=x[b.operator],f?f(_c(b.argument,c,d,e)):void 0;case Cd:case Dd:return f=y[b.operator],f?f(_c(b.left,c,d,e),_c(b.right,c,d,e)):void 0;case wd:if("@"===b.name.charAt(0)){for(k=b.name.slice(1),l=d.length-1;l>=0;l--)if(g=d[l].at,g&&_(g,k)){j=g[k];break}}else j=c[b.name];return C(j)?j.get():j;case xd:return g=_c(b.object,c,d,e),Wc(g,b.property,c,d,e);case vd:return _c(b.body[0],c,d,e);case Fd:return g=K(d).this_exp,Wc(g,b.argument,c,d,e);case Ed:return g=d&&d.length>1?d[d.length-2].this_exp:void 0,Wc(g,b.argument,c,d,e);case Ad:if(b.callee.type===xd?(h=_c(b.callee.object,c,d,e),g=Wc(h,b.callee.property,c,d,e)):(h=a,g=_c(b.callee,c,d,e)),g&&S(g))return i=bb(b.arguments,function(a){return _c(a,c,d,e)}),g.apply(h,i)}},ad=function(a){return 3===a.nodeType?Vc(b(a)):Vc(Uc(a))},bd=function(a,b,c){return Ib(function(){return bb(a,function(a){if("unary_hb"===a.type)return a.literal?_c(a.val,b,c):Vc(_c(a.val,b,c));var d=$c(a);return R(d)?bb(d,ad).join(""):ad(d)}).join("")})},cd=function(a){return Ib(function(){var b=[];return ab(a,function(a){var c=$c(a);R(c)?b.push.apply(b,c):b.push(c)}),b})},dd=/^\{\{([\-A-Za-z0-9_]+)\}\}/,ed=function(a,b){for(var c,d,e,f,g=!1,h=[];a.length>0;){if(c=a.indexOf("{"),0>c){h.push(a);break}d=a.match(dd),d?(e=d[0].length,f=b[d[1]],a=a.substr(e),h.push(f),g||!C(f)&&!D(f)||(g=!0)):(h.push(a.substr(0,c)),a=a.substr(c))}return g?Ib(function(){return bb(h,function(a){return C(a)?a.get():D(a)?a.join(" "):""+a}).join("")}):h.join("")},fd={},gd=function(a,b){return a===b||a&&a.is_obj===fd&&a.key===b.key&&a.value===b.value},hd=/^(data-)?cjs-out$/,id=/^(data-)?cjs-on-(\w+)$/,jd=function(a){var b={children:[],type:"root"},c=[b],d=!1,e=[],f=[];return Rc(a,{startHTML:function(a,b,e){d={type:"html",tag:a,attributes:b,unary:e,children:[]},K(c).children.push(d),e||c.push(d)},endHTML:function(){d=c.pop()},HTMLcomment:function(a){d={type:"comment",str:a},K(c).children.push(d)},chars:function(a){d={type:"chars",str:a},K(c).children.push(d)},startHB:function(a,b,g,h){if(g)d={type:"unary_hb",parsed_content:b,literal:h,tag:a},K(c).children.push(d);else{var i=!0;switch(d={type:"hb",tag:a,children:[]},a){case"each":d.parsed_content=Zc(b),d.else_child=!1;break;case"unless":case"if":d.reverse="unless"===a,d.sub_conditions=[],d.condition=Zc(b),f.push(d);break;case"elif":case"else":i=!1;var j=K(c);"hb"===j.type&&"each"===j.tag?j.else_child=d:K(f).sub_conditions.push(d),d.condition="else"===a?Xc:Zc(b);break;case"each":case"fsm":d.fsm_target=Zc(b),d.sub_states={},e.push(d);break;case"state":var k=b.body[1].name;K(e).sub_states[k]=d,i=!1;break;case"with":d.content=Zc(b)}i&&K(c).children.push(d),c.push(d)}},endHB:function(a){switch(a){case"if":case"unless":f.pop();break;case"fsm":e.pop()}c.pop()},partialHB:function(a,b){d={type:"partial_hb",tag:a,content:Zc(b)},K(c).children.push(d)}}),b},kd=function(a,b){ab(a,function(a){_(a,b)&&a[b]()})},ld=function(a,b,c,d){var e,f,g=a.type;if("chars"===g)return{type:g,node:u.createTextNode(a.str)};if("root"===g||"html"===g){var h,i=arguments;if(e=bb(a.children,function(a){return ld(a,b,c)}),"root"===g)if(d)f=d;else{if(1===e.length&&"html"===a.children[0].type)return e[0];f=u.createElement("span")}else f=u.createElement(a.tag);var j=[];if(ab(a.attributes,function(a){if(a.name.match(hd))b[a.value]=ic(f);else if(h=a.name.match(id)){var d=h[2];F(f,d,b[a.value])}else{var e=ed(a.value,b,c);C(e)?"class"===a.name?j.push(dc(f,e)):j.push(gc(f,a.name,e)):f.setAttribute(a.name,e)}}),Tc(a.children)){var k=bd(e,b,c);j.push(k,bc(f,k))}else{var l=cd(e,i);j.push(l,ec(f,l))}return{node:f,type:g,pause:function(){kd(e.concat(j),"pause")},resume:function(){kd(e.concat(j),"resume")},destroy:function(){kd(e.concat(j),"destroy")}}}if("unary_hb"===g){var m,n,o=Yc(a.parsed_content),p=a.literal,q=Ib(function(){return _c(o,b,c)});if(!p){var r=Ib.get(q);nd(r)?m=od(r):(m=u.createTextNode(""+r),n=ac(m,q))}return{type:g,literal:a.literal,val:o,node:m,destroy:function(){n&&n.destroy(!0)},pause:function(){n&&n.pause()},resume:function(){n&&n.resume()}}}if("hb"===g){var s=a.tag;if("each"===s){var t,v=[],w=[],x=[];return{type:g,getNodes:function(){t=_c(a.parsed_content,b,c),D(t)&&(t=t.toArray()),R(t)?0===t.length&&a.else_child&&(t=[Xc]):E(t)?(t=t.entries(),ab(t,function(a){a.is_obj=fd})):t=bb(t,function(a,b){return{key:b,value:a,is_obj:fd}});var d=Cb(v,t,gd);return ab(d.index_changed,function(a){var b=w[a.from];b&&b.at&&b.at.index&&b.at.index.set(a.to)}),ab(d.removed,function(a){var b=a.from,c=w[b];x.splice(b,1),c&&c.at&&ab(c.at,function(a){a.destroy(!0)})}),ab(d.added,function(d){var e=d.item,f=d.to,g=e===Xc,h=g?!1:e&&e.is_obj===fd?{this_exp:e.value,at:{key:Ib.constraint(e.key)}}:{this_exp:e,at:{index:Ib.constraint(f)}},i=g?c:c.concat(h),j=bb(g?a.else_child.children:a.children,function(a){var c=ld(a,b,i),d=$c(c);return d});x.splice(f,0,j),w.splice(f,0,h)},this),ab(d.moved,function(a){var b=a.from_index,c=a.to_index,d=mdom[b],e=w[b];x.splice(b,1),x.splice(c,0,d),w.splice(b,1),w.splice(c,0,e)}),v=t,P(x,!0)}}}if("if"===s||"unless"===s)return e=[],{type:g,getNodes:function(){var d,f=a.sub_conditions.length,g=!!_c(a.condition,b,c),h=!1;if(a.reverse&&(g=!g),g)d=0,h=a.children;else if(f>0)for(d=0;f>d;d++)if(g=a.sub_conditions[d],g.condition===Xc||_c(g.condition,b,c)){h=g.children,d++;break}return h?(e[d]||(h=0===d?a.children:a.sub_conditions[d-1].children,e[d]=P(bb(h,function(a){return ld(a,b,c)}),!0)),P(bb(e[d],$c),!0)):[]}};if("fsm"===s){var y={};return{type:g,getNodes:function(){var d,e=_c(a.fsm_target,b,c),f=e.getState(),g=function(a){return ld(a,b,c)};c||(c=[]);for(d in a.sub_states)if(a.sub_states.hasOwnProperty(d)&&f===d){var h;return h=_(y,d)?y[d]:y[d]=P(bb(a.sub_states[d].children,g),!0),P(bb(h,$c),!0)}return[]}}}if("with"===s){var z=_c(a.content,b,c),A=c.concat({this_exp:z});return e=P(bb(a.children,function(a){return ld(a,z,A)})),{node:P(bb(e,$c),!0)}}}else{if("partial_hb"===g){var B=md[a.tag],G=_c(a.content,b,c),H=B(G);return{node:H,pause:function(){H.pause()},destroy:function(){H.destroy()},resume:function(){ndoes.resume()}}}if("comment"===g)return{node:u.createComment(a.str)}}return{node:[]}},md={},nd=function(a){return Ub(a)||Wb(a)||W(a)},od=function(a){return Ub(a)||Wb(a)?a[0]:W(a)?a:!1},pd=[],qd=[],rd=1,sd=function(a,b){var c=this,d=ld(c,a,[{this_exp:a}],od(b)),e=d.node,f=d.id=rd++;return qd[f]=d,pd[f]=e,e.setAttribute("data-cjs-template-instance",f),e},td=function(a){var b=a.getAttribute("data-cjs-template-instance");return b||(b=gb(pd,a)),b},ud=function(a){var b=td(a);return b>=0?qd[b]:!1};db(Ib,{createTemplate:function(a){T(a)||(a=Ub(a)||Wb(a)?a.length>0?t(b(a[0])):"":V(a)?t(b(a)):""+a);var c=jd(a);return arguments.length>=2?sd.apply(c,M(arguments)):s(sd,c)},registerPartial:function(a,b){return md[a]=b,this},unregisterPartial:function(a){return delete md[a],this},destroyTemplate:function(a){var b=td(od(a)),c=b>=0?qd[b]:!1;return c&&(c.destroy(),delete qd[b]),this},pauseTemplate:function(a){var b=ud(a);return b&&b.pause(),this},resumeTemplate:function(a){var b=ud(a);return b&&b.resume(),this}});var vd="Compound",wd="Identifier",xd="MemberExpression",yd="Literal",zd="ThisExpression",Ad="CallExpression",Bd="UnaryExpression",Cd="BinaryExpression",Dd="LogicalExpression",Ed="ParentExpression",Fd="CurrLevelExpression",Gd=function(){var a=!0,b={"-":a,"!":a,"~":a,"+":a},c={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},d=function(a){var b,c=0;for(var d in a)(b=d.length)>c&&a.hasOwnProperty(d)&&(c=b);return c},e=d(b),f=d(c),g={"true":!0,"false":!1,"null":null},h="this",i=function(a){return c[a]||0},j=function(a,b,c){var d="||"===a||"&&"===a?Dd:Cd;return{type:d,operator:a,left:b,right:c}},k=function(a){return a>=48&&57>=a},l=function(a){return 36===a||95===a||64===a||a>=65&&90>=a||a>=97&&122>=a},m=function(a){return 36===a||95===a||a>=65&&90>=a||a>=97&&122>=a||a>=48&&57>=a},n=function(a){for(var d,n,o=0,p=a.charAt,q=a.charCodeAt,r=function(b){return p.call(a,b)},s=function(b){return q.call(a,b)},t=a.length,u=function(){for(var a=s(o);32===a||9===a;)a=s(++o)},v=function(){u();for(var b=a.substr(o,f),d=b.length;d>0;){if(c.hasOwnProperty(b))return o+=d,b;b=b.substr(0,--d)}return!1},w=function(){var a,b,c,d,e,f,g,h;if(f=x(),b=v(),!b)return f;if(e={value:b,prec:i(b)},g=x(),!g)throw new Error("Expected expression after "+b+" at character "+o);for(d=[f,e,g];(b=v())&&(c=i(b),0!==c);){for(e={value:b,prec:c};d.length>2&&c<=d[d.length-2].prec;)g=d.pop(),b=d.pop().value,f=d.pop(),a=j(b,f,g),d.push(a);if(a=x(),!a)throw new Error("Expected expression after "+b+" at character "+o);d.push(e),d.push(a)}for(h=d.length-1,a=d[h];h>1;)a=j(d[h-1].value,d[h-2],a),h-=2;return a},x=function(){var c,d,f;if(u(),c=s(o),46===c&&47===a.charCodeAt(o+1))return o+=2,{type:Fd,argument:x()};if(46===c&&46===a.charCodeAt(o+1)&&47===a.charCodeAt(o+2))return o+=3,{type:Ed,argument:x()};if(k(c)||46===c)return y();if(39===c||34===c)return z();if(l(c))return C();if(40===c)return D();for(d=a.substr(o,e),f=d.length;f>0;){if(b.hasOwnProperty(d))return o+=f,{type:Bd,operator:d,argument:x(),prefix:!0};d=d.substr(0,--f)}return!1},y=function(){for(var a="";k(s(o));)a+=r(o++);if("."===r(o))for(a+=r(o++);k(s(o));)a+=r(o++);if("e"===r(o)||"E"===r(o)){for(a+=r(o++),("+"===r(o)||"-"===r(o))&&(a+=r(o++));k(s(o));)a+=r(o++);if(!k(s(o-1)))throw new Error("Expected exponent ("+a+r(o)+") at character "+o)}if(l(s(o)))throw new Error("Variable names cannot start with a number ("+a+r(o)+") at character "+o);return{type:yd,value:parseFloat(a),raw:a}},z=function(){for(var a,b="",c=r(o++),d=!1;t>o;){if(a=r(o++),a===c){d=!0;break}if("\\"===a)switch(a=r(o++)){case"n":b+="\n";break;case"r":b+="\r";break;case"t":b+="	";break;case"b":b+="\b";break;case"f":b+="\f";break;case"v":b+=""}else b+=a}if(!d)throw new Error('Unclosed quote after "'+b+'"');return{type:yd,value:b,raw:c+b+c}},A=function(){var b,c=s(o),d=o;if(!l(c))throw new Error("Unexpected "+r(o)+"at character "+o);for(o++;t>o&&(c=s(o),m(c));)o++;return b=a.slice(d,o),g.hasOwnProperty(b)?{type:yd,value:g[b],raw:b}:b===h?{type:zd}:{type:wd,name:b}},B=function(){for(var a,b,c=[];t>o;){if(u(),a=r(o),")"===a){o++;break}if(","===a)o++;else{if(b=w(),!b||b.type===vd)throw new Error("Expected comma at character "+o);c.push(b)}}return c},C=function(){var a,b,c;for(b=A(),u(),a=r(o);"."===a||"["===a||"("===a;){if("."===a)o++,u(),b={type:xd,computed:!1,object:b,property:A()};else if("["===a){if(c=o,o++,b={type:xd,computed:!0,object:b,property:w()},u(),a=r(o),"]"!==a)throw new Error("Unclosed [ at character "+o);o++,u()}else"("===a&&(o++,b={type:Ad,arguments:B(),callee:b});u(),a=r(o)}return b},D=function(){o++;var a=w();if(u(),")"===r(o))return o++,a;throw new Error("Unclosed ( at character "+o)},E=[];t>o;)if(d=r(o),";"===d||","===d)o++;else if(n=w())E.push(n);else if(t>o)throw new Error("Unexpected '"+r(o)+"' at character "+o);return 1===E.length?E[0]:{type:vd,body:E}};return n.version="0.9.4-beta",n.toString=function(){return"JavaScript Expression Parser (JSEP) v"+n.version},n.addUnaryOp=function(c){return b[c]=a,this},n.addBinaryOp=function(a,b){return f=Math.max(a.length,f),c[a]=b,this},n.removeUnaryOp=function(a){return delete b[a],a.length===e&&(e=d(b)),this},n.removeBinaryOp=function(a){return delete c[a],a.length===f&&(f=d(c)),this},n}();return Ib}(this);"undefined"!=typeof module&&module.exports&&(module.exports=cjs);
//# sourceMappingURL=cjs.min.js.map