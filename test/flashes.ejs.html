<!DOCTYPE html>
<html lang="en">
  <head>
    <title>red</title>
  </head>
  <body>
		<div class="content">
		</div>
	  <div>
			<%- red_include(red_inc.main) %>
			<script type="text/javascript">
				var env = red.create("environment");

				env	.cd("children")
					.set("obj", "<stateful>")
					.cd("obj")
					.rename_state("INIT", "flash1")
					.add_state("flash2")
					.add_transition("flash1", "flash2", "on('timeout', interval)")
					.add_transition("flash2", "flash1", "on('timeout', 2*interval)")
					.set("(protos)", "flash1", "dom")
					.set("tag")
					.set("text")
					.set("tag", "flash1", "'div'")
					.set("text", "flash1", "'hello'")
					.set("css", "<dict>")
					.cd("css")
					.set("backgroundColor", "<stateful prop>")
					.set("backgroundColor", "flash1", "'red'")
					.set("backgroundColor", "flash2", "'green'")
					.on_state("flash1", function() {
							console.log(arguments);
						})
					.top()
					.set("interval", "500")
					;
				var root_pointer = env.get_root_pointer();
				output_view = $("<div />").dom_output({
					root: root_pointer
				}).appendTo(document.body);

				//env.set("interval", "10");
				window.invalidate = function() {
						debugger;
						interval.invalidate();
						interval.set(function() {
							return 10;
						});
					};

				env.print_on_return = true;
				console.log(env.print());
			</script>
	  </div>
  </body>
</html>
