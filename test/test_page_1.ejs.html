<!DOCTYPE html>
<html lang="en">
  <head>
    <title>red</title>
	<script type="text/javascript" src="../server/jquery-1.7.2.min.js"></script>
	<%- red_include(red_inc.main) %>

	<script type="text/javascript">
		$(function() {
			var square = $("#square")[0];
			var sc = red.create_statechart()
						.add_state("idle")
						.add_state("dragging")
						.starts_at("idle")
						.add_transition("idle", "dragging", red.create_event("dom_event", "mousedown", square))
						.add_transition("dragging", "idle", red.create_event("dom_event", "mouseup", window))
						.in_state("dragging")
							.add_state("non_gridded")
							.add_state("gridded")
							.add_transition("non_gridded", "gridded", red.create_event("dom_event", "keydown", window).guard(function(event) {
								return event.which === 32;
							}))
							.add_transition("gridded", "non_gridded", red.create_event("dom_event", "keyup", window).guard(function(event) {
								return event.which === 32;
							}))
							.starts_at("non_gridded")
						.up()
						.run();
			var obj = red	.create_object()
							.set_statechart(sc)
							.add_prop("prop1")
							.find_prop("prop1")
								.set_value(sc.get_state_with_name("idle"), 1)
								.set_value(sc.get_state_with_name("dragging"), 2)
							.up();
								
			$(window).on("keydown", function(event) {
				if(event.keyCode === 83) { // s
					console.log(obj.find_prop("prop1").get());
					console.log(
						red.cjs._.map(sc.get_state(), function(statechart) {
							return statechart.my_name();
						}));
				}
			});
		});
	</script>

	<style type="text/css">
		div#square {
			width: 100px;
			height: 100px;
			background-color: red;
		}
	</style>
  </head>
  <body>
	<div id="square"></div>
	Hello
  </body>
</html>
