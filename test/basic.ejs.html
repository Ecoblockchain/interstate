<!DOCTYPE html>
<html lang="en">
  <head>
    <title>red</title>
  </head>
  <body>
		<div class="content">
		</div>
	  <div>
			<%- red_include(red_inc.main) %>
			<script type="text/javascript">
				var tree = {
					a: {},
					b: {
						c: {},
						d: {
							e: {}
						}
					}
				};
				var env = red.create("environment");
				env	
					.set("tree", tree)
					.set("keys", function(x) { return x ? red._.keys(x) : []; })
					.set("values", function(x) { return x ? red._.values(x) : []; })
					.set("disp", "<dict>")
					.cd("disp")
						.set("(protos)", "[dom]")
						.set("node", "val")
						.set("ks", "keys(node)")
						.set("vs", "values(node)")
						.set("children", "<dict>")
						.cd("children")
							.set("my_name", "<dict>")
							.cd("my_name")
								.set("(protos)", "dom")
								.set("text", "name")
								.up()
							.set("child_disp", "<dict>")
							.cd("child_disp")
								.set("(protos)", "root.disp")
								.set("(manifestations)", "parent.parent.vs.length")
								.set("val", "parent.parent.vs[basis_index]")
								.set("name", "parent.parent.ks[basis_index]")
								.up()
							.up()
						.up()
					.cd("children")
					.set("root_disp", "<dict>")
					.cd("root_disp")
						.set("(protos)", "disp")
						.set("val", "tree")
						.set("name", "'root'")
						.up()
					.up()
					;

				output_view = $("<div />").dom_output({
					root: env.get_root()
				}).appendTo(document.body);
				env.print_on_return = true;
				console.log(env.print());
			</script>
	  </div>
  </body>
</html>
