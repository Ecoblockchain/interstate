<!DOCTYPE html>
<html lang="en">
  <head>
    <title>red</title>
  </head>
  <body>
		<div class="content">
		</div>
	  <div>
			<%- red_include(red_inc.main) %>
			<script type="text/javascript">
				var env = red.create("environment");
				env
.cd("children")
	.set("obj", "<stateful>")
	.cd("obj")
		.rename_state("INIT", "idle")
		.add_state("editing")
		.add_transition("idle", "editing", "on('mousedown', this)")
		.add_transition("editing", "idle", "on('keydown', this).when_eq('keyCode', 13)")
		//.add_transition("editing", "idle", "on('keydown', this).when_eq('keyCode', 27)")
		.set("(protos)", "idle", "[dom]")
		.set("tag")
		.set("tag", "idle", "'span'")
		.set("tag", "editing", "'input'")
		.set("text")
		.set("text", "idle", "'init_val'")
		.set("attr", "<dict>")
		.cd("attr")
			.set("value", "<stateful_prop>")
			.set("value", "idle -> editing", "text")
			.up()
		.on_state("idle -> editing", "function(event) {\n" +
			"console.log('select me');\n" +
		"}")
		.on_state("editing >0- idle", "function(event) {\n" +
			"var value = event.target.value;\n" +
			"console.log('set cell to', value);\n" +
		"}")
;

				output_view = $("<div />").dom_output({
					root: env.get_root()
				}).appendTo(document.body);
				env.print_on_return = true;
				console.log(env.print());
			</script>
	  </div>
  </body>
</html>
