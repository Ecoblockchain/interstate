<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Interstate Runtime: Same Window</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  </head>
  <body>
		<div class="output"></div>
		<!--<canvas id="canvas" width="600" height="100"></canvas>-->
		<div id="editor"></div>
	  <div>
			<%- ist_include(ist_inc.vendor) %>
			<%- ist_include(ist_inc.runtime) %>
			<%- ist_include(ist_inc.editor) %>
			<%- ist_include(ist_inc.runtime_style) %>
			<script type="text/javascript">
				var root = interstate.get_default_root([]);
				$("div#editor").editor({
					debug_env: true,
					server_window: window
				});
				$("div.output").dom_output({
					open_separate_client_window: false,
					edit_on_open: true,
					show_edit_button: false,
					root: root
				});
				function getRoot() {
					return $("div.output").dom_output("option", "root");
				}
				function getEnvironment() {
					return new interstate.Environment({root: getRoot()});
				}
				window.env = getEnvironment();
				env.set("a", "<stateful>")
				/*
				env.set("message", "<stateful>")
					.cd("message")
					.add_state("init")
					.add_state("other")
					.start_at("init")
					.add_transition("init", "other", "on('mousedown', this);event.preventDefault()")
					.add_transition("other", "init", "on('timeout', 500)")
					.set("(prototypes)", "(start)", "dom.h1")
					.set("textContent", "init", "'hello'")
					.set("textContent", "other", "'goodbye'")
				/*
				env.set("steves_world", "<stateful>")
					.cd("steves_world")
					.set("(prototypes)", "(start)", "[physics.world]")
					.set("gy", "(start)", "0.0")
					.top()
					.set("sketch", "<stateful>")
					.cd("sketch")
					.set("(prototypes)", "(start)", "svg.paper")
					.set("circ", "<stateful>")
					.cd("circ")
					.set("cx", "(start)", "200")
					.set("cy", "(start)", "200")
					.set("fixed", "(start)", "true")
					.add_state("init")
					.start_at("init")
					.set("(prototypes)", "(start)", "[svg.circle, physics.fixture]")
					.add_transition("init", "init", "on('click');emit('hi')")
					//.set("cx", "init", "computed_x")
					//.set("cy", "init", "computed_y")
					//.set("fixed", "init", "false")
					.set("world", "(start)", "steves_world")

				env .top()
				/*
				env.print();
				env.set("b", "<stateful>")

				env.cd("super_obj");

				var super_obj = env.get_pointer_obj;
				var cobj = interstate.find_or_put_contextual_obj(super_obj, env.pointer);

				interstate.cjs.liven(function() {
					console.log(cobj.children());
				});
			

				//env.print_on_return = true;
				env.set("(copies)", "1")
					.set("(copies)", "")
				*/
			</script>
	  </div>
  </body>
</html>
