<!DOCTYPE html>
<html lang="en">
  <head>
    <title>red</title>
  </head>
  <body>
	  <!--<h1>red</h1>-->

		<div class="content">
		</div>

	  <div>
			<%- red_include(red_inc.main) %>

			<script type="text/javascript">
				var root, env, cjs, _, root_view;
				$(function() {
					cjs = red.cjs;
					_ = red._;

					env = red	.create("environment");


env			
.set("w", "600")
.set("h", "600")
.cd("children")
	.set("ball", "<stateful>")
	.cd("ball")
		.set("(protos)", "INIT", "dom")
		.set("tag", "INIT", "'div'")
		.set("attr", "<dict>")
		.cd("attr")
			.up()
		.set("css", "<dict>")
		.cd("css")
			.set("position", "'absolute'")
			.set("left", "x+'px'")
			.set("top", "y+'px'")
			.set("width", "ballWidth+'px'")
			.set("height", "ballHeight+'px'")
			.set("backgroundColor", "'red'")
			.up()
		.set("x", "(start) -> INIT", "w/2")
		.set("y", "(start) -> INIT", "h/2")
		.set("vx", "(start) -> INIT", "400")
		.set("vy", "(start) -> INIT", "500")
		.set("FPS", "60")
		.add_transition("INIT", "INIT", "on('timeout', 1000/FPS)")
		.set("x", "INIT -0> INIT", "x+(vx/FPS)")
		.set("y", "INIT -0> INIT", "y+(vy/FPS)")
		.add_transition("INIT", "INIT", "x <= 0")
		.set("vx", "INIT -1> INIT", "-vx")
		.add_transition("INIT", "INIT", "x + ballWidth >= w")
		.set("vx", "INIT -2> INIT", "-vx")
		.add_transition("INIT", "INIT", "y <= 0")
		.set("vy", "INIT -3> INIT", "-vy")
		.add_transition("INIT", "INIT", "y + ballHeight >= h-paddle.ph")
		.set("vy", "INIT -4> INIT", "-vy")
		.up()
	.set("paddle", "<stateful>")
	.cd("paddle")
		.set("(protos)", "INIT", "dom")
		.set("tag", "INIT", "'div'")
		.set("pw", "(start) -> INIT", "90")
		.set("ph", "(start) -> INIT", "20")
		.set("x", "(start) -> INIT", "(w-pw)/2")
		.add_transition("INIT", "INIT", "on('keydown').when_eq('keyCode', 37)")
		.set("x", "INIT-0>INIT", "x-5")
		.add_transition("INIT", "INIT", "on('keydown').when_eq('keyCode', 39)")
		.set("x", "INIT-1>INIT", "x+5")

		.set("attr", "<dict>")
		.cd("attr")
			.up()
		.set("css", "<dict>")
		.cd("css")
			.set("position", "'absolute'")
			.set("top", "(h-ph)+'px'")
			.set("width", "pw+'px'")
			.set("height", "ph+'px'")
			.set("backgroundColor", "'black'")
			.set("left", "x+'px'")
			.up()
		.up()
	.set("blocks", "<stateful>")
	.cd("blocks")
		.rename_state("INIT", "alive")
		.set("(protos)", "alive", "dom")
		.set("(manifestations)", "num_cols*5")
		.set("row", "(basis - (basis % num_cols))/num_cols")
		.set("col", "basis % num_cols")
		.set("css", "<dict>")
		.cd("css")
			.set("position", "alive", "'absolute'")
			.set("left", "alive", "(col*block_width)+'px'")
			.set("top", "alive", "(row*block_height)+'px'")
			.set("width", "alive", "block_width + 'px'")
			.set("height", "alive", "block_height + 'px'")
			.set("border", "alive", "'1px solid black'")
			.set("display", "alive", "'visible'")
			.set("backgroundColor", "alive", "colors[basis%colors.length]")
			.up()
		.up()
	.set("container", "<stateful>")
	.cd("container")
		.set("(protos)", "INIT", "dom")
		.set("css", "<dict>")
		.cd("css")
			.set("position", "INIT", "'absolute'")
			.set("left", "INIT", "'0px'")
			.set("top", "INIT", "'0px'")
			.set("width", "INIT", "w+'px'")
			.set("height", "INIT", "h+'px'")
			.set("border", "INIT", "'1px solid black'")
			.up()
		.up()
	.up()
.set("num_cols", "5")
.set("block_width", "w/num_cols")
.set("block_height", "30")
.set("colors", "['red', 'orange', 'yellow', 'green', 'blue', 'purple']")
.set("ballWidth", "30")
.set("ballHeight", "ballWidth")
;
					var root_pointer = env.get_root_pointer();
					output_view = $("<div />").dom_output({
						root: root_pointer
					}).appendTo(document.body);

					env.print_on_return = true;
					//console.log(env.print());
				});
			</script>
	  </div>
  </body>
</html>
