<!DOCTYPE html>
<html lang="en">
  <head>
    <title>red</title>
  </head>
  <body>
	  <!--<h1>red</h1>-->

		<div class="content">
		</div>

	  <div>
			<%- red_include(red_inc.main) %>

			<script type="text/javascript">
				var root, env, cjs, _, root_view;
				$(function() {
					cjs = red.cjs;
					_ = red._;

					env = red	.create("environment");


env			
.set("w", "600")
.set("h", "600")
.cd("children")
	.set("ball", "<stateful>")
	.cd("ball")
		.set("(protos)", "INIT", "dom")
		.set("tag", "INIT", "'img'")
		.set("attr", "<dict>")
		.cd("attr")
			.set("src", "'ball.png'")
			.up()
		.set("css", "<dict>")
		.cd("css")
			.set("position", "'absolute'")
			.set("left", "x+'px'")
			.set("top", "y+'px'")
			.up()
		.set("x", "(start) -> INIT", "w/2")
		.set("y", "(start) -> INIT", "h/2")
		.set("vx", "(start) -> INIT", "400")
		.set("vy", "(start) -> INIT", "500")
		.set("FPS", "60")
		.add_transition("INIT", "INIT", "on('timeout', 1000/FPS)")
		.set("x", "INIT -0> INIT", "x+(vx/FPS)")
		.set("y", "INIT -0> INIT", "y+(vy/FPS)")
		.add_transition("INIT", "INIT", "x <= 0")
		.set("vx", "INIT -1> INIT", "-vx")
		.add_transition("INIT", "INIT", "x >= w-70")
		.set("vx", "INIT -2> INIT", "-vx")
		.add_transition("INIT", "INIT", "y <= 0")
		.set("vy", "INIT -3> INIT", "-vy")
		.add_transition("INIT", "INIT", "y >= h-70-paddle.ph")
		.set("vy", "INIT -4> INIT", "-vy")
		.up()
	.set("paddle", "<stateful>")
	.cd("paddle")
		.set("(protos)", "INIT", "dom")
		.set("tag", "INIT", "'div'")
		.set("pw", "(start) -> INIT", "90")
		.set("ph", "(start) -> INIT", "20")
		.set("x", "(start) -> INIT", "(w-pw)/2")
		.add_transition("INIT", "INIT", "on('keydown').when_eq('keyCode', 37)")
		.set("x", "INIT-0>INIT", "x-5")
		.add_transition("INIT", "INIT", "on('keydown').when_eq('keyCode', 39)")
		.set("x", "INIT-1>INIT", "x+5")

		.set("attr", "<dict>")
		.cd("attr")
			.up()
		.set("css", "<dict>")
		.cd("css")
			.set("position", "'absolute'")
			.set("top", "(h-ph)+'px'")
			.set("width", "pw+'px'")
			.set("height", "ph+'px'")
			.set("backgroundColor", "'black'")
			.set("left", "x+'px'")
			.up()

;
					var root_pointer = env.get_root_pointer();
					output_view = $("<div />").dom_output({
						root: root_pointer
					}).appendTo(document.body);

					env.print_on_return = true;
					//console.log(env.print());
				});
			</script>
	  </div>
  </body>
</html>
