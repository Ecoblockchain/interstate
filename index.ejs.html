<!DOCTYPE html>
<html lang="en">
  <head>
    <title>InterState Runtime</title>
	<meta charset="utf-8" />
	<meta author="Stephen Oney" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<% 
		var color = "";
		if(addr === "128.2.177.95") {
			color = "";
		} else if(addr === "192.168.1.3") {
			color = "green";
		} else if(addr === "192.168.1.13") {
			color = "blue";
		} else {
			color = "";
		}
		var big_logo_url = color === "" ? "interstate_logo_512" : "interstate_logo_512_"+color;
		var small_logo_url = "interstate_logo_128";
	%>

	<link rel="shortcut icon" href="dist/images/<%=small_logo_url %>.png" /> 
	<link rel="apple-touch-icon-precomposed" href="dist/images/<%=big_logo_url %>.png" />
  </head>
  <body>
		<div class="content">
		</div>
	  <div>
			<%- ist_include(ist_inc.vendor) %>
			<%- ist_include(ist_inc.runtime) %>
			<%- ist_include(ist_inc.runtime_style) %>

			<script type="text/javascript">
				var env, the_div, root, nosave = false, dom_output_options = {
						auto_open_external_editor: true,
						//external_editor: true,
						//edit_on_open: true,
						editor_url: window.location.protocol + "//" + window.location.host + "/src/view/editor/editor.ejs.html"
					};
				window.save = function(name) {
					return interstate.save(the_div.dom_output("option", "root"), name);
				};
				window.load = function(name) {
					root = interstate.load(name);
					if(the_div.data("dom_output")) {
						the_div.dom_output("destroy")
					}
					if(env) {
						env.destroy();
					}
					env = new interstate.Environment({root: root});
					env.print_on_return = true;
					dom_output_options.root = root;
					the_div.dom_output(dom_output_options);
					return root;
				};
				window.ls = interstate.ls;

				$(function() {
					the_div = $("<div />").appendTo(document.body);
					try {/**/ root = load(); //*
					} catch(e) {
						console.log("Creating a new project");
						env = new interstate.Environment();

						dom_output_options.root = env.get_root();

						the_div.dom_output(dom_output_options);
						env.print_on_return = true;
					}
						/**/
				});
				var nosave_delay = false;
				$(window).on("beforeunload onunload unload pagehide", function() {
					if(window.nosave !== true) {
						if(nosave_delay === false) {
							save();
							nosave_delay = true;
							setTimeout(function() {
								nosave_delay = false;
							}, 400);
						}
					}
				});
				window.nuke = function() {
					nosave = true;
					interstate.nuke();
				};
				//nosave = true;
			</script>
	  </div>
  </body>
</html>
