<!DOCTYPE html>
<html lang="en">
  <head>
    <title>red</title>
	<link rel="stylesheet" type="text/css" href="src/view/css/styles.css"></link>
	<link rel="stylesheet" type="text/css" href="src/_vendor/bootstrap/css/bootstrap.css"></link>
  </head>
  <body>
	  <!--<h1>red</h1>-->

		<div class="content">
		</div>

	  <div>
			<%- red_include(red_inc.main) %>
			<script type="text/javascript" src="src/_vendor/bootstrap/js/bootstrap.js"></script>

			<script type="text/javascript">
				var root, env, cjs, _, root_view;
				$(function() {
					cjs = red.cjs;
					_ = red._;

					red.__debug = false;

					var use_local_storage = true;
					if(use_local_storage && localStorage.stringified_root) {
						root = red.destringify(localStorage.stringified_root);
						env = red.create("environment", {root: root});
					} else {
						env = red.create("environment");
						root = env.get_pointer();
					}
					root_view = $("<div />").environment({controller: env}).appendTo(document.body);
					console.log(env.print());

					$(window).on("unload", function() {
							try {
								var stringified_root = red.stringify(root);
								localStorage.stringified_root = stringified_root;
							} catch(e) {
								console.log("ERROR");
							}
					});
					/*
					var stringify_button = $("<a />")	.attr("href", "javascript:void(0)")
														.text("stringify")
														.on("click", function() {
																var stringified_root = red.stringify(root);
																root_view.environment("destroy");
																root.destroy();

																root_view.text("Refreshing");

																window.setTimeout(function() {
																		root_view.html("");
																		root = red.destringify(stringified_root);
																		env = red.create("environment", {root: root});

																		root_view.environment({controller: env});
																		console.log(env.print());
																}, 100);
														})
														.appendTo(document.body)
														.click();
					*/
				});
			</script>
	  </div>
  </body>
</html>
